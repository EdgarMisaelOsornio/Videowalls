<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buscador y Organizador de Videowalls</title>
<style>
body { font-family: "Segoe UI", Arial, sans-serif; background-color: #f5f6fa; color: #2d3436; margin:0; padding:30px; }
h1 { text-align:center; color:#2d3436; margin-bottom:10px; }
h3 { margin-top:30px; color:#0984e3; }
.container { max-width:1100px; margin:auto; background:white; border-radius:16px; box-shadow:0 2px 10px rgba(0,0,0,0.1); padding:25px; }
textarea { width:100%; height:120px; resize:vertical; font-family:monospace; padding:10px; border-radius:8px; border:1px solid #ccc; margin-bottom:20px; }
input[type=file] { display:block; margin:15px 0; font-size:16px; }
button { background-color:#0984e3; color:white; border:none; padding:10px 20px; font-size:16px; border-radius:8px; cursor:pointer; transition:0.3s; margin-right:10px; }
button:hover { background-color:#74b9ff; }
table { width:100%; border-collapse:collapse; margin-top:25px; }
th, td { padding:10px; border:1px solid #ddd; text-align:left; }
th { background-color:#0984e3; color:white; }
tr:nth-child(even) { background-color:#f9f9f9; }
.match { color:#00b894; font-weight:bold; }
.no-match { color:#d63031; font-weight:bold; }
.section { margin-bottom:40px; }
</style>
</head>
<body>
<h1>Buscador y Organizador de Videowalls</h1>
<div class="container">

  <!-- Buscar por nombre -->
  <div class="section">
    <h3>1Ô∏è‚É£ Buscar por nombre de oficina</h3>
    <textarea id="solicitudes" placeholder="Ejemplo:
[0001]MEXICO NORTE
[0051]ZACATECAS
[0010]QUERETARO"></textarea>
    <button onclick="buscarPorNombre()">üîç Buscar por nombre</button>
    <div id="resultadoNombres"></div>
  </div>

  <!-- Buscar por archivos -->
  <div class="section">
    <h3>2Ô∏è‚É£ Buscar por archivos CSV</h3>
    <input type="file" id="archivos" multiple accept=".csv"/>
    <button onclick="buscarPorArchivos()">üìÅ Procesar archivos</button>
    <button onclick="descargarZip()">üíæ Descargar ZIP por proveedor</button>
    <div id="resultadoArchivos"></div>
  </div>

</div>

<!-- JSZip desde CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
// Base de datos
const base = [
   ["TCUS0","ACAPULCO CUAUHTEMOC SALA 1","MAGIC"],
  ["ALUS0","ACAPULCO PAPAGAYO SALA UNICA","MAGIC"],
  ["APVS0","AG. TLAQUEPAQUE SALA UNICA","MAX"],
  ["AGSS0","AGUASCALIENTES SALA 1","MAX"],
  ["OBRS1","CD OBREGON SALA 1","TECNOMANIA"],
  ["CELS0","CELAYA SALA UNICA","MAX"],
  ["CHIS0","CHIHUAHUA SALA UNICA","TECNOMANIA"],
  ["CHGS0","CHILPANCINGO SALA 1","MAGIC"],
  ["JUAS0","CIUDAD JUAREZ SALA  UNICA","TECNOMANIA"],
  ["JUAS2","CIUDAD JUAREZ SALA 2","TECNOMANIA"],
  ["JUAS3","CIUDAD JUAREZ SALA 3","TECNOMANIA"],
  ["CUES0","CUERNAVACA SALA UNICA","MAX"],
  ["CULS0","CULIACAN SALA UNICA","MAX"],
  ["DGOS0","DURANGO SALA UNICA","MAX"],
  ["ENSS0","ENSENADA SALA 1","MAGIC"],
  ["GOMS0","GOMEZ PALACIO SALA UNICA","MAX"],
  ["GDAS0","GUADALAJARA SALA UNICA MOD 7","MAX"],
  ["HERS0","HERMOSILLO SALA UNICA","MAX"],
  ["IRAS0","IRAPUATO SALA UNICA","MAX"],
  ["CRCS0","LAS CRUCES SALA UNICA","TECNOMANIA"],
  ["LEOS0","LEON SALA UNICA","MAX"],
  ["MATS0","MATAMOROS SALA 1","MAX"],
  ["MAZS0","MAZATLAN SALA UNICA","MAX"],
  ["MXIS1","MEXICALI SALA 1","TECNOMANIA"],
  ["MXIS2","MEXICALI SALA 2","TECNOMANIA"],
  ["MXN1A","MEXICO NORTE SALA 1 1ER PANTALLA","MAX"],
  ["MXN1B","MEXICO NORTE SALA 1 2DA PANTALLA","MAX"],
  ["MXN2A","MEXICO NORTE SALA 2","MAX"],
  ["MXN2B","MEXICO NORTE SALA 2.5","TECNOMANIA"],
  ["MXN3A","MEXICO NORTE SALA 3","TECNOMANIA"],
  ["MXN4A","MEXICO NORTE SALA 4 1ER PANTALLA","TECNOMANIA"],
  ["MXN4B","MEXICO NORTE SALA 4 2DA PANTALLA","MAX"],
  ["MXN5A","MEXICO NORTE SALA 5 1ER PANTALLA","MAX"],
  ["MXN5B","MEXICO NORTE SALA 5 2DA PANTALLA","MAX"],
  ["MXN6A","MEXICO NORTE SALA 6","MAX"],
  ["MXN8A","MEXICO NORTE SALA 8","TECNOMANIA"],
  ["MXSS1","MEXICO SUR SALA 1","MAX"],
  ["MOCS0","MOCHIS SALA UNICA","STRATECH"],
  ["MONS0","MONCLOVA SALA UNICA","MAX"],
  ["MTYS0","MONTERREY SALA UNICA","MAX"],
  ["MORS0","MORELIA SALA UNICA","MAX"],
  ["MRNS0","MOROLEON SALA UNICA","MAX"],
  ["PCHS0","PACHUCA SALA UNICA","MAX"],
  ["UGBS0","PISTOLAS MENESES UNICA","MAX"],
  ["POZS0","POZA RICA SALA UNICA","STRATECH"],
  ["PUES0","PUEBLA SALA UNICA","MAX"],
  ["VTAS0","PUERTO VALLARTA SALA UNICA","MAX"],
  ["QROS1","QUERETARO SALA 1","TECNOMANIA"],
  ["REYS0","REYNOSA SALA UNICA","MAX"],
  ["SCAS0","SALAMANCA SALA UNICA","MAX"],
  ["SJR01","SAN JUAN DEL RIO SALA 1","MAX"],
  ["SLPS0","SAN LUIS POTOSI SALA UNICA","MAX"],
  ["SMAS1","SAN MIGUEL DE ALLENDE SALA 1","MAX"],
  ["SILS0","SILAO SALA UNICA","MAX"],
  ["TPOS0","TAMPICO SALA 1","MAX"],
  ["TAXS0","TAXCO SALA 01","MAX"],
  ["TEPS1","TEPIC SALA 1","MAX"],
  ["ZLTS1","TEPOTZOTLAN SALA 1","MAX"],
  ["TIJS0","TIJUANA SALA UNICA","TECNOMANIA"],
  ["TOLS0","TOLUCA SALA UNICA","MAX"],
  ["TORS1","TORREON SALA 1","MAX"],
  ["ZACS0","ZACATECAS SALA UNICA","MAX"],
  ["APNS1","ZAPOPAN P NORTE SALA 1","MAX"],
  ["ZIHS0","ZIHUATANEJO SALA 1","MAGIC"],
  ["SJLS0","SAN JUAN DE LOS LAGOS SALA UNICA","MAX"]
];

let archivosSubidos = []; // Para almacenar archivos seleccionados

// Buscar por nombre (con soporte para c√≥digos entre corchetes)
function buscarPorNombre(){
  const solicitudesTexto = document.getElementById('solicitudes').value.trim();
  const resultadoDiv = document.getElementById('resultadoNombres');
  if(!solicitudesTexto){ alert("Ingresa al menos un nombre de oficina."); return; }

  const solicitudes = solicitudesTexto.split(/\n/).map(s=>{
    // Eliminar c√≥digo entre corchetes si existe
    return s.replace(/^\[\d+\]/,"").trim().toUpperCase();
  }).filter(s=>s);

  let tabla = `<table><thead><tr><th>Oficina Solicitada</th><th>Coincide</th><th>Proveedores</th><th># Archivos</th></tr></thead><tbody>`;

  solicitudes.forEach(oficina=>{
    const coincidencias = base.filter(b=>b[1].toUpperCase().includes(oficina));
    if(coincidencias.length>0){
      const proveedores = [...new Set(coincidencias.map(c=>c[2]))].join(", ");
      tabla += `<tr><td>${oficina}</td><td class="match">‚úÖ S√≠</td><td>${proveedores}</td><td>${coincidencias.length}</td></tr>`;
    } else {
      tabla += `<tr><td>${oficina}</td><td class="no-match">‚ùå No</td><td>‚Äî</td><td>0</td></tr>`;
    }
  });
  tabla += "</tbody></table>";
  resultadoDiv.innerHTML = tabla;
}

// Buscar por archivos
function buscarPorArchivos(){
  const input = document.getElementById('archivos');
  const resultadoDiv = document.getElementById('resultadoArchivos');
  const archivos = input.files;
  if(!archivos.length){ alert("Selecciona uno o m√°s archivos."); return; }

  archivosSubidos = Array.from(archivos); // Guardamos para ZIP

  let tabla = `<table><thead><tr><th>Archivo</th><th>C√≥digo detectado</th><th>Nombre Completo</th><th>Proveedor</th><th>Coincide</th></tr></thead><tbody>`;

  archivosSubidos.forEach(archivo=>{
    const nombre = archivo.name.split('.')[0].toUpperCase().trim();
    const encontrado = base.find(b=>b[0]===nombre);
    if(encontrado){
      tabla += `<tr><td>${archivo.name}</td><td>${nombre}</td><td>${encontrado[1]}</td><td>${encontrado[2]}</td><td class="match">‚úÖ S√≠</td></tr>`;
    } else {
      tabla += `<tr><td>${archivo.name}</td><td>${nombre}</td><td>‚Äî</td><td>‚Äî</td><td class="no-match">‚ùå No encontrado</td></tr>`;
    }
  });
  tabla += "</tbody></table>";
  resultadoDiv.innerHTML = tabla;
}

// Descargar ZIP por proveedor
function descargarZip(){
  if(archivosSubidos.length===0){ alert("No hay archivos importados."); return; }

  const zip = new JSZip();
  archivosSubidos.forEach(archivo=>{
    const nombre = archivo.name.split('.')[0].toUpperCase().trim();
    const encontrado = base.find(b=>b[0]===nombre);
    const proveedor = encontrado ? encontrado[2] : "SIN_PROVEEDOR";
    zip.folder(proveedor).file(archivo.name, archivo);
  });

  zip.generateAsync({type:"blob"}).then(function(content){
    saveAs(content, "Archivos_Videowalls.zip");
  });
}
</script>
</body>
</html>
