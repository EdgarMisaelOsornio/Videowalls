<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buscador y Organizador de Videowalls</title>
<style>
body { font-family: "Segoe UI", Arial, sans-serif; background-color: #f5f6fa; color: #2d3436; margin:0; padding:30px; }
h1 { text-align:center; color:#2d3436; margin-bottom:10px; }
h3 { margin-top:30px; color:#0984e3; }
.container { max-width:1100px; margin:auto; background:white; border-radius:16px; box-shadow:0 2px 10px rgba(0,0,0,0.1); padding:25px; }
textarea { width:100%; height:120px; resize:vertical; font-family:monospace; padding:10px; border-radius:8px; border:1px solid #ccc; margin-bottom:20px; }
input[type=file] { display:block; margin:15px 0; font-size:16px; }
button { background-color:#0984e3; color:white; border:none; padding:10px 20px; font-size:16px; border-radius:8px; cursor:pointer; transition:0.3s; margin-right:10px; }
button:hover { background-color:#74b9ff; }
table { width:100%; border-collapse:collapse; margin-top:25px; }
th, td { padding:10px; border:1px solid #ddd; text-align:left; }
th { background-color:#0984e3; color:white; }
tr:nth-child(even) { background-color:#f9f9f9; }
.match { color:#00b894; font-weight:bold; }
.no-match { color:#d63031; font-weight:bold; }
.section { margin-bottom:40px; }
</style>
</head>
<body>
<h1>Buscador y Organizador de Videowalls</h1>
<div class="container">

  <div class="section">
    <h3>1Ô∏è‚É£ Buscar por nombre de oficina</h3>
    <textarea id="solicitudes" placeholder="Ejemplo:
[0001]MEXICO NORTE
ACAPULCO, PAPAGAYO
CD. JUAREZ
NAVA"></textarea>
    <button onclick="buscarPorNombre()">üîç Buscar por nombre</button>
    <div id="resultadoNombres"></div>
  </div>

  <div class="section">
    <h3>2Ô∏è‚É£ Buscar por archivos CSV</h3>
    <input type="file" id="archivos" multiple accept=".csv"/>
    <button onclick="buscarPorArchivos()">üìÅ Procesar archivos</button>
    <button onclick="descargarZip()">üíæ Descargar ZIP por proveedor</button>
    <div id="resultadoArchivos"></div>
  </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
// --- BASE DE DATOS ---
const base = [
  ["TCUS0","ACAPULCO CUAUHTEMOC SALA 1","MAGIC"],
  ["ALUS0","ACAPULCO PAPAGAYO SALA UNICA","MAGIC"],
  ["APVS0","AG. TLAQUEPAQUE SALA UNICA","MAX"],
  ["AGSS0","AGUASCALIENTES SALA 1","MAX"],
  ["OBRS1","CD OBREGON SALA 1","TECNOMANIA"],
  ["CELS0","CELAYA SALA UNICA","MAX"],
  ["CHIS0","CHIHUAHUA SALA UNICA","TECNOMANIA"],
  ["CHGS0","CHILPANCINGO SALA 1","MAGIC"],
  ["JUAS0","CIUDAD JUAREZ SALA  UNICA","TECNOMANIA"],
  ["JUAS2","CIUDAD JUAREZ SALA 2","TECNOMANIA"],
  ["JUAS3","CIUDAD JUAREZ SALA 3","TECNOMANIA"],
  ["CUES0","CUERNAVACA SALA UNICA","MAX"],
  ["CULS0","CULIACAN SALA UNICA","MAX"],
  ["DGOS0","DURANGO SALA UNICA","MAX"],
  ["ENSS0","ENSENADA SALA 1","MAGIC"],
  ["GOMS0","GOMEZ PALACIO SALA UNICA","MAX"],
  ["GDAS0","GUADALAJARA SALA UNICA MOD 7","MAX"],
  ["HERS0","HERMOSILLO SALA UNICA","MAX"],
  ["IRAS0","IRAPUATO SALA UNICA","MAX"],
  ["CRCS0","LAS CRUCES SALA UNICA","TECNOMANIA"],
  ["LEOS0","LEON SALA UNICA","MAX"],
  ["MATS0","MATAMOROS SALA 1","MAX"],
  ["MAZS0","MAZATLAN SALA UNICA","MAX"],
  ["MXIS1","MEXICALI SALA 1","TECNOMANIA"],
  ["MXIS2","MEXICALI SALA 2","TECNOMANIA"],
  ["MXN1A","MEXICO NORTE SALA 1 1ER PANTALLA","MAX"],
  ["MXN1B","MEXICO NORTE SALA 1 2DA PANTALLA","MAX"],
  ["MXN2A","MEXICO NORTE SALA 2","MAX"],
  ["MXN2B","MEXICO NORTE SALA 2.5","TECNOMANIA"],
  ["MXN3A","MEXICO NORTE SALA 3","TECNOMANIA"],
  ["MXN4A","MEXICO NORTE SALA 4 1ER PANTALLA","TECNOMANIA"],
  ["MXN4B","MEXICO NORTE SALA 4 2DA PANTALLA","MAX"],
  ["MXN5A","MEXICO NORTE SALA 5 1ER PANTALLA","MAX"],
  ["MXN5B","MEXICO NORTE SALA 5 2DA PANTALLA","MAX"],
  ["MXN6A","MEXICO NORTE SALA 6","MAX"],
  ["MXN8A","MEXICO NORTE SALA 8","TECNOMANIA"],
  ["MXSS1","MEXICO SUR SALA 1","MAX"],
  ["MOCS0","MOCHIS SALA UNICA","STRATECH"],
  ["MONS0","MONCLOVA SALA UNICA","MAX"],
  ["MTYS0","MONTERREY SALA UNICA","MAX"],
  ["MORS0","MORELIA SALA UNICA","MAX"],
  ["MRNS0","MOROLEON SALA UNICA","MAX"],
  ["LARS0","NUEVO LAREDO SALA UNICA","TECNOMANIA"],
  ["PCHS0","PACHUCA SALA UNICA","MAX"],
  ["UGBS0","PISTOLAS MENESES UNICA","MAX"],
  ["POZS0","POZA RICA SALA UNICA","STRATECH"],
  ["PUES0","PUEBLA SALA UNICA","MAX"],
  ["VTAS0","PUERTO VALLARTA SALA UNICA","MAX"],
  ["QROS1","QUERETARO SALA 1","TECNOMANIA"],
  ["REYS0","REYNOSA SALA UNICA","MAX"],
  ["SCAS0","SALAMANCA SALA UNICA","MAX"],
  ["SJR01","SAN JUAN DEL RIO SALA 1","MAX"],
  ["SLPS0","SAN LUIS POTOSI SALA UNICA","MAX"],
  ["SMAS1","SAN MIGUEL DE ALLENDE SALA 1","MAX"],
  ["SILS0","SILAO SALA UNICA","MAX"],
  ["TPOS0","TAMPICO SALA 1","MAX"],
  ["TAXS0","TAXCO SALA 01","MAX"],
  ["TEPS1","TEPIC SALA 1","MAX"],
  ["ZLTS1","TEPOTZOTLAN SALA 1","MAX"],
  ["TIJS0","TIJUANA SALA UNICA","TECNOMANIA"],
  ["TOLS0","TOLUCA SALA UNICA","MAX"],
  ["TORS1","TORREON SALA 1","MAX"],
  ["TGOS0","TULANCINGO SALA UNICA","TECNOMANIA"],
  ["ZACS0","ZACATECAS SALA UNICA","MAX"],
  ["APNS1","ZAPOPAN P NORTE SALA 1","MAX"],
  ["ZIHS0","ZIHUATANEJO SALA 1","MAGIC"],
  ["SJLS0","SAN JUAN DE LOS LAGOS SALA UNICA","MAX"]
];

// --- UTILIDADES ---
function normalizar(texto){
  return texto
    .replace(/^\[[^\]]+\]/,"")       // Quita c√≥digos [0001]
    .replace(/^\d+\s*/,"")           // Quita n√∫meros iniciales (0319)
    .replace(/,/g," ")               // Comas -> espacio
    .replace(/\./g,"")               // Quita puntos
    .replace(/\s+/g," ")             // Espacios m√∫ltiples
    .replace(/\bCD\b/gi,"CIUDAD")   // CD -> CIUDAD
    .trim()
    .toUpperCase();
}

// --- BUSCAR POR NOMBRE ---
function buscarPorNombre(){
  const solicitudes = document.getElementById("solicitudes").value.trim().split("\n");
  const resultado = document.getElementById("resultadoNombres");
  resultado.innerHTML = "";

  let tabla = `<table><thead><tr><th>Oficina buscada</th><th>Coincidencias en Base de Datos</th></tr></thead><tbody>`;

  solicitudes.forEach(linea=>{
    const oficina = normalizar(linea);
    if(!oficina) return;

    // Coincidencia estricta de palabras completas usando regex
    const coincidencias = base.filter(b=>{
      const nombreBase = normalizar(b[1]);
      return oficina.split(" ").every(p=>{
        const re = new RegExp(`\\b${p}\\b`,"i"); // palabra completa
        return re.test(nombreBase);
      });
    });

    if(coincidencias.length === 0){
      tabla += `<tr><td>${linea.trim()}</td><td class="no-match">‚ùå No encontrada</td></tr>`;
    } else {
      const lista = coincidencias.map(c=>`${c[1]} ‚Äî <strong>${c[2]}</strong>`).join("<br>");
      tabla += `<tr><td>${linea.trim()}</td><td class="match">‚úÖ<br>${lista}</td></tr>`;
    }
  });

  tabla += "</tbody></table>";
  resultado.innerHTML = tabla;
}

// --- BUSCAR POR ARCHIVOS ---
let archivosSubidos = [];
function buscarPorArchivos(){
  const archivos = document.getElementById("archivos").files;
  const resultado = document.getElementById("resultadoArchivos");
  resultado.innerHTML = "";
  if(!archivos.length) return;

  archivosSubidos = Array.from(archivos);

  let tabla = `<table><thead><tr><th>Archivo</th><th>C√≥digo</th><th>Nombre Completo</th><th>Proveedor</th><th>Estado</th></tr></thead><tbody>`;

  archivosSubidos.forEach(archivo=>{
    const codigo = archivo.name.replace(/\s*\(.*\)/,"").split('.')[0].toUpperCase();
    const match = base.find(b => b[0] === codigo);
    if(match){
      tabla += `<tr><td>${archivo.name}</td><td>${codigo}</td><td>${match[1]}</td><td>${match[2]}</td><td class="match">‚úÖ</td></tr>`;
    } else {
      tabla += `<tr><td>${archivo.name}</td><td>${codigo}</td><td>‚Äî</td><td>‚Äî</td><td class="no-match">‚ùå</td></tr>`;
    }
  });

  tabla += "</tbody></table>";
  resultado.innerHTML = tabla;
}

// --- DESCARGAR ZIP ---
function descargarZip(){
  if(!archivosSubidos.length) return alert("No hay archivos procesados.");
  const zip = new JSZip();
  archivosSubidos.forEach(archivo=>{
    const codigo = archivo.name.replace(/\s*\(.*\)/,"").split('.')[0].toUpperCase();
    const match = base.find(b => b[0] === codigo);
    const proveedor = match ? match[2] : "SIN_PROVEEDOR";
    zip.folder(proveedor).file(archivo.name, archivo);
  });
  zip.generateAsync({type:"blob"}).then(c=>saveAs(c,"Archivos_Videowalls.zip"));
}
</script>
</body>
</html>
